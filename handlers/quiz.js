'use strict';const _=require("lodash"),{generateMWords}=require("./util"),DATA=require("./quiz-data.json"),IDEAL_DOC={three_words:null,url:null,title:null,description:null,topics:[],start:null,duration:null,file_upload:!0,status:0,username:null,created_at:_.now(),updated_at:_.now()};function sanitize(a){let b=_.cloneDeep(a);for(let c in a)(_.isNil(a[c])||"created_at"===c||"three_words"===c)&&_.omit(b,c);return!_.isNil(a.duration)&&_.isString(a.duration)&&(b.duration=parseInt(a.duration)),!_.isNil(a.topics)&&_.isString(a.topics)&&(b.topics=a.topics.split(",")),b}function createQuizHandler(a){try{let b=_.merge(IDEAL_DOC,sanitize(a.body));return b.three_words=generateMWords(3,"-"),{statusCode:201,body:JSON.stringify(b)}}catch(a){return{statusCode:500}}}function listQuizHandler(a){try{let b=_.has(null===a||void 0===a?void 0:a.queryStringParameters,"limit")?parseInt(a.queryStringParameters.limit):DATA.length,c=_.chain(DATA).sampleSize(b).map(a=>_.omit(a,["questions","responses"])).value();return{statusCode:200,body:JSON.stringify({total_docs:DATA.length,docs:c})}}catch(a){return{statusCode:500}}}function getQuizHandler(a){try{let b=_.find(DATA,{three_words:a.pathParameters.threeWords});return _.isEmpty(b)?{statusCode:404}:{statusCode:200,body:JSON.stringify(_.omit(b,["questions","responses"]))}}catch(a){return{statusCode:500}}}function updateQuizHandler(a){try{let b=_.find(DATA,{three_words:a.pathParameters.threeWords});return _.isEmpty(b)?{statusCode:404}:{statusCode:200,body:JSON.stringify(_.merge(b,sanitize(a.body)))}}catch(a){return{statusCode:500}}}function deleteQuizHandler(){return{statusCode:204}}function collateQuizHandler(a){let b=_.chain(DATA).find({three_words:a.pathParameters.threeWords}).omit("responses").value();return b.questions=b.questions.map(a=>_.omit(a,"answers")),_.isEmpty(b)?{statusCode:404}:{statusCode:200,body:JSON.stringify(b)}}function evaluateQuizHandler(a){let{method:b}=a.requestContext.http;console.log(b);let{threeWords:c}=a.pathParameters;switch(b){case"GET":{let a=_.find(DATA,{three_words:c});return _.isEmpty(a)?{statusCode:404}:{statusCode:200,body:JSON.stringify(a)}}case"POST":return{statusCode:201,body:JSON.stringify(a.body)};case"PUT":return{statusCode:200};default:}return{statusCode:500}}module.exports={createQuizHandler,listQuizHandler,getQuizHandler,updateQuizHandler,deleteQuizHandler,collateQuizHandler,evaluateQuizHandler};